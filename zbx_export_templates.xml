<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>5.0</version>
    <date>2023-08-25T13:26:18Z</date>
    <groups>
        <group>
            <name>Templates/Modules</name>
        </group>
    </groups>
    <templates>
        <template>
            <template>Template Cluster1C TM</template>
            <name>Template Cluster1C TM</name>
            <groups>
                <group>
                    <name>Templates/Modules</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>Cluster1C</name>
                </application>
                <application>
                    <name>Cluster1C-lic</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>Free_Client_Licenses_Count</name>
                    <type>CALCULATED</type>
                    <key>Free_Client_Licenses_Count</key>
                    <delay>10m</delay>
                    <status>DISABLED</status>
                    <value_type>FLOAT</value_type>
                    <params>last(&quot;vfs.file.contents[C:\zabbix\scripts\Cluster1C\LicensesCount.txt]&quot;)-last(&quot;vfs.file.contents[C:\zabbix\scripts\Cluster1C\Users_Count.txt]&quot;)</params>
                    <applications>
                        <application>
                            <name>Cluster1C</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Get_Cluster_Info_bat_launcher</name>
                    <key>Get.Cluster.Info</key>
                    <delay>10m</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <description>Короч элемент чисто для запуска батника по рассписанию</description>
                    <applications>
                        <application>
                            <name>Cluster1C</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Information_Bases_Count</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>vfs.file.contents[C:\zabbix2\scripts\Cluster1C\Information_Bases_Count.txt]</key>
                    <delay>10m</delay>
                    <description>Кол-во ИБ</description>
                    <applications>
                        <application>
                            <name>Cluster1C</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Client_Licenses_Count</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>vfs.file.contents[C:\zabbix2\scripts\Cluster1C\LicensesCount.txt]</key>
                    <delay>120m</delay>
                    <status>DISABLED</status>
                    <applications>
                        <application>
                            <name>Cluster1C</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Licenses_Serv_Count</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>vfs.file.contents[C:\zabbix2\scripts\Cluster1C\LicensesServCount.txt]</key>
                    <delay>10m</delay>
                    <description>Чисто серверные лицензии. Считается прям в PS скрипте по номерам ключей</description>
                    <applications>
                        <application>
                            <name>Cluster1C</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Licenses_TS_Count</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>vfs.file.contents[C:\zabbix2\scripts\Cluster1C\LicensesTSCount.txt]</key>
                    <delay>10m</delay>
                    <description>Чисто TS лицензии. Считается прям в PS скрипте по номерам ключей</description>
                    <applications>
                        <application>
                            <name>Cluster1C</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Working_Users_count</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>vfs.file.contents[C:\zabbix2\scripts\Cluster1C\Users_Count.txt]</key>
                    <delay>10m</delay>
                    <description>Сколько работают в базах</description>
                    <applications>
                        <application>
                            <name>Cluster1C</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Working_Processes_Count</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>vfs.file.contents[C:\zabbix2\scripts\Cluster1C\Working_Processes_Count.txt]</key>
                    <delay>10m</delay>
                    <description>Сколько процессов в кластерах</description>
                    <applications>
                        <application>
                            <name>Cluster1C</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Exist_Client_Licenses_Count_File</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>vfs.file.exists[C:\zabbix2\scripts\Cluster1C\LicensesCount.txt]</key>
                    <delay>120m</delay>
                    <status>DISABLED</status>
                    <applications>
                        <application>
                            <name>Cluster1C</name>
                        </application>
                    </applications>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>Information bases discovery</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>vfs.file.contents[C:\zabbix2\scripts\Cluster1C\Bases_List.txt,CP866]</key>
                    <delay>10m</delay>
                    <filter>
                        <conditions>
                            <condition>
                                <macro>{#IBDNAME}</macro>
                                <value>^.*$</value>
                                <formulaid>A</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <item_prototypes>
                        <item_prototype>
                            <name>1C Base {#IBDNAME} - {#IBDDESCR} - working users count</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>vfs.file.regexp[C:\zabbix2\scripts\Cluster1C\Bases_List.txt,^.*&quot;{#IBDNAME}&quot;.*$,CP866]</key>
                            <delay>10m</delay>
                            <value_type>FLOAT</value_type>
                            <applications>
                                <application>
                                    <name>Cluster1C-lic</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>REGEX</type>
                                    <params>IBDUSERCOUNT.*&quot;([0-9]*)&quot;
\1</params>
                                </step>
                            </preprocessing>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{count(#1000,0)}=1000</expression>
                                    <name>{HOST.NAME} - база 1С {#IBDNAME} база не используется 1 неделю</name>
                                    <priority>INFO</priority>
                                    <manual_close>YES</manual_close>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{count(#2000,0)}=2000</expression>
                                    <name>{HOST.NAME} - база 1С {#IBDNAME} база не используется 2 недели</name>
                                    <priority>WARNING</priority>
                                    <manual_close>YES</manual_close>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{count(#3000,0)}=3000</expression>
                                    <name>{HOST.NAME} - база 1С {#IBDNAME} база не используется 3 недели</name>
                                    <priority>AVERAGE</priority>
                                    <manual_close>YES</manual_close>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{count(#4000,0)}=4000</expression>
                                    <name>{HOST.NAME} - база 1С {#IBDNAME} база не используется 4 недели</name>
                                    <priority>HIGH</priority>
                                    <manual_close>YES</manual_close>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{count(#5000,0)}=5000</expression>
                                    <name>{HOST.NAME} - база 1С {#IBDNAME}  база не используется более месяца. Перенести базу в архив.</name>
                                    <priority>DISASTER</priority>
                                    <manual_close>YES</manual_close>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                </discovery_rule>
            </discovery_rules>
        </template>
    </templates>
    <triggers>
        <trigger>
            <expression>{Template Cluster1C TM:vfs.file.contents[C:\zabbix2\scripts\Cluster1C\LicensesCount.txt].last()}=0 or {Template Cluster1C TM:vfs.file.exists[C:\zabbix2\scripts\Cluster1C\LicensesCount.txt].last()}=0</expression>
            <name>{HOST.NAME} - не указано количество клиентских лицензий 1С</name>
            <status>DISABLED</status>
            <priority>WARNING</priority>
            <manual_close>YES</manual_close>
        </trigger>
        <trigger>
            <expression>1-({Template Cluster1C TM:vfs.file.contents[C:\zabbix2\scripts\Cluster1C\Users_Count.txt].last()}/{Template Cluster1C TM:vfs.file.contents[C:\zabbix2\scripts\Cluster1C\LicensesCount.txt].last()})&lt;0.2</expression>
            <name>{HOST.NAME} - осталось мало клиентских лицензий 1С</name>
            <status>DISABLED</status>
            <priority>WARNING</priority>
            <manual_close>YES</manual_close>
        </trigger>
    </triggers>
    <graphs>
        <graph>
            <name>1C_Client_Licenses_Count</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <ymax_type_1>FIXED</ymax_type_1>
            <graph_items>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>1A7C11</color>
                    <item>
                        <host>Template Cluster1C TM</host>
                        <key>vfs.file.contents[C:\zabbix2\scripts\Cluster1C\LicensesServCount.txt]</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>2</sortorder>
                    <color>FFFF00</color>
                    <item>
                        <host>Template Cluster1C TM</host>
                        <key>vfs.file.contents[C:\zabbix2\scripts\Cluster1C\LicensesTSCount.txt]</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>1С_Information_Bases_Count</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <color>1A7C11</color>
                    <item>
                        <host>Template Cluster1C TM</host>
                        <key>vfs.file.contents[C:\zabbix2\scripts\Cluster1C\Information_Bases_Count.txt]</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>1С_Working_Processes_Count</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <color>1A7C11</color>
                    <item>
                        <host>Template Cluster1C TM</host>
                        <key>vfs.file.contents[C:\zabbix2\scripts\Cluster1C\Working_Processes_Count.txt]</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>1С_Working_Users_count</name>
            <ymin_type_1>FIXED</ymin_type_1>
            <graph_items>
                <graph_item>
                    <color>1A7C11</color>
                    <item>
                        <host>Template Cluster1C TM</host>
                        <key>vfs.file.contents[C:\zabbix2\scripts\Cluster1C\Users_Count.txt]</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
    </graphs>
</zabbix_export>
